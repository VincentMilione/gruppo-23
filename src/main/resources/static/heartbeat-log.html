<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/stile.css" type = "text/css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <title>Heartbeat Log</title>
	<script>
		$(function(){
			$("#navbar").load("header.html");
		});
  </script>
</head>
<body>
<div id= navbar></div>
<div class="contorno" style="background-image: url('img/bg_1.jpg');">
  <div class="container">
    <div class="row no-gutters slider-text align-items-center justify-content-center">
      <div class="col-md-9 ftco-animate text-center">
        <h1 class="mb-0 bread">Monitoraggio battiti</h1>
      </div>
    </div>
  </div>
</div>

<hr>


<div class="container">
    <!-- Search form -->
    <div  class="form-inline d-flex justify-content-center md-form form-sm mt-0">
        <i class="fas fa-search" aria-hidden="true"></i>
        <input class="form-control form-control-sm ml-3 w-75" type="text" placeholder="Inserisci nome animale"
        aria-label="Search" name="srch">
        <button id="cerca" type="submit" class="form-control form-control-sm" > Cerca</button>
    </div><br>
    <table id="heart" class="table table-striped">
      <thead>
        <tr>
          <th name="gps">Codice Gps</th>
          <th name="name">Nome</th>
          <th name="type">Tipo</th>
          <th name="beat">Battiti</th>
          <th name="details">Storico</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div class="container">
    <ul class="pagination justify-content-center">
      <li class="page-item disabled"><a class="page-link" href="#">Pagina</a></li>
      
    </ul>
  </div>
<!--Modal per le info-->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <!--Header-->
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New message</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <!--il corpo-->
        <div class="modal-body">
          <label>Codice GPS: </label>
          <label id = "gps"></label><br>
          <label>Tipo: </label>
          <label id = "type"></label><br>
          <label>Battiti: </label>
          <label id = "heartbeat"></label><br>
          <label>Storico: </label>
          <table id = "history" class="table table-striped">
            <thead>
              <tr>
                <th>Lun</th>
                <th>Mar</th>
                <th>Mer</th>
                <th>Gio</th>
                <th>Ven</th>
                <th>Sab</th>
                <th>Dom</th>
              </tr>
            </thead>
            <tbody>
          
            </tbody>
          </table>
         <label> Note: </label> 
        <label id = "note"></label>

        </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Chiudi</button>
        </div>
      </div>
    </div>
  </div>
<script src="js/animal.js"></script>
<script src = "js/loadTable.js"></script>
<script src = "js/search.js"></script>
<script>
$('document').ready(function() {
  //getAnimal
  var register = new Register();
  loader("heart",register.heartBeatLog());
  pager(register.heartBeatLog())

  $('#exampleModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var gps = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  var animal = register.getAnimal(gps)

  var tr = $('<tr>')

    tr.append('<td>'+animal.hrtbtH[0]+'</td>')
        .append('<td>'+animal.hrtbtH[1]+'</td>')
        .append('<td>'+animal.hrtbtH[2]+'</td>')
        .append('<td>'+animal.hrtbtH[3]+'</td>')
        .append('<td>'+animal.hrtbtH[4]+'</td>')
        .append('<td>'+animal.hrtbtH[5]+'</td>')
        .append('<td>'+animal.hrtbt+'</td>')

  modal.find('.modal-title').text(animal.name)
  modal.find('.modal-body #name').append(animal.name)
  modal.find('.modal-body #gps').append(animal.tracker)
  modal.find('.modal-body #type').append(animal.type)
  modal.find('.modal-body #heartbeat').append(animal.hrtbt)
  modal.find('.modal-body #history').find('tbody').append(tr)
  modal.find('.modal-body #note').append(animal.note)
  
});

//
$('#exampleModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)

  modal.find('.modal-title').text("")
  modal.find('.modal-body #name').html("")
  modal.find('.modal-body #gps').html("")
  modal.find('.modal-body #type').html("")
  modal.find('.modal-body #heartbeat').html("")
  modal.find('.modal-body #history').find('tbody').html("")
  modal.find('.modal-body #note').html("")
});

//paginare la lista e creare le sezioni delle pagine(di conseguenza attaccare anche dei listener dei bottoni)
function pager (list) {
  //resettare il coso della paginazione
  $('.page-item').not('.disabled').remove()

  let nPg = (list.length/10)
  for (var i = 0; i < nPg; i++)  {
    var btn = i==0 ? '<li class="page-item active"><a class="page-link" href="#">'+(i+1)+'</a></li>' : '<li class="page-item"><a class="page-link" href="#">'+(i+1)+'</a></li>'
    $('.pagination').append(btn)
    
  }

  $('.page-item').click(function(){
      let num = parseInt($(this).find("a").html())
  
      $('.page-item').removeClass('active')
      $(this).addClass('active')
      $('#heart tbody tr:visible').hide()
      $('#heart tbody tr').slice((num-1)*10,(num*10)-1).show()
    })
}

$('#cerca').click(function(){
        //fare un filter su elementi che possiedono nell'html una substring del nome dell'animale
        let list = register.heartBeatLog()
        let page = []
        $('#heart tbody tr').remove()
      
        list.forEach(e =>{
            let str = e.name
            let srch = $('input[name = "srch"]').val()
           
            if(str.indexOf(srch)>=0){
                page.push(e)
            }
        });

        pager(page)
        loader("heart", page)
        //dobbiamo ricorda che possiamo avere solo 10 elementi per pagin
    })
});
</script>
</body>
</html>