<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/stile.css" type = "text/css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="js/animal.js"></script>
    <script src = "js/loadTable.js"></script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <title>Registro dati</title>
	<script>
		$(function(){
			$("#navbar").load("header.html");
		});
  </script>
</head>
<body>
<div id= navbar></div>
<div class="contorno" style="background-image: url('img/bg_1.jpg');">
  <div class="container">
    <div class="row no-gutters slider-text align-items-center justify-content-center">
      <div class="col-md-9 ftco-animate text-center">
        <h1 class="mb-0 bread">Registro dati</h1>
      </div>
    </div>
  </div>
</div>

<hr>


<div class="container">
    <!-- Search form -->
    <form class="form-inline d-flex justify-content-left md-form form-sm mt-0" id="ricerca">
        <i class="fas fa-search" aria-hidden="true"></i>
        <input class="form-control form-control-sm ml-3 " type="text" placeholder="Inserisci nome animale"
        aria-label="Search" name="srch" style="width: 70%; margin-right: 8px;">
        <button id="cerca" type="submit" class="form-control form-control" > Cerca</button>
        <span><button id="aggiungi" type="submit" class="form-control form-control" > Aggiungi Nuovo Animale</button></span>
    </form><br>
    
    <table id="register" class="table table-striped">
      <thead>
        <tr>
          <th name="gps">Codice Gps</th>
          <th name="name">Nome</th>
          <th name="type">Tipo</th>
		   <th name="info">Info</th>
		  <th name="modify">Modifica</th>
          <th name="delete">Elimina</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div class="container">
    <ul class="pagination justify-content-center">
      <li class="page-item disabled"><a class="page-link" href="#">Pagina</a></li>
      
    </ul>
  </div>

<!--Modal per icona info -->
<div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="infoModalLabel">New message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <label><strong>Codice GPS:</strong>  </label>
        <label id = "gps"></label><br>
        <label><strong>Nascita:</strong>  </label>
        <label id="bday"></label><br>
        <label><strong>Tipo:</strong> </label>
        <label id = "type"></label><br>
        <label><strong>Sesso:</strong> </label>
        <label id = "sex"></label><br>
        <label><strong>Litri di latte prodotto:</strong> </label>
        <label id = "milk"></label><br>
        <label><strong>Numero di parti:</strong> </label>
        <label id= "children"></label><br>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Chiudi</button>
        </div>
      </div>
    </div>
  </div>

  <!--Modal per icona modifica -->
<div class="modal fade" id="modificaModal" tabindex="-1" role="dialog" aria-labelledby="modificaModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="modificaModalLabel">New message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <label hidden ><strong> GPS:</strong> </label>
        <input hidden id="gps" name="gps"></label><br>
        <label><strong>Litri di latte prodotto:</strong> </label>
        <label id = "milk"></label>
        <span><input name="litres" type="number" id="milkLitres" value="-1" min="0" max="100" step="1"/></span><br>
        <label><strong>Numero di parti:</strong> </label>
        <label id= "children"></label>
        <span><input type="number" id="numberChildren" name="children" value="-1" min="0" max="100" step="1"/></span>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" id="modifyButton" class="btn btn-secondary" data-dismiss="modal">Salva</button>
        </div>
      </div>
    </div>
  </div>

  <!--Modal per icona elimina -->
<div class="modal fade" id="eliminaModal" tabindex="-1" role="dialog" aria-labelledby="eliminaModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="eliminaModalLabel">New message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <label hidden ><strong> GPS:</strong> </label>
        <input hidden id="gpsToDelete" name="gpsToDelete"></label><br>
        <label>Sei sicuro di voler eliminare</label>
        <strong id="animalName"></strong>
        <label>dal registro?</label>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" id="eliminaButton" class="btn btn-primary" data-dismiss="modal">Si</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">No</button>
        </div>
      </div>
    </div>
  </div>


<script>
$('document').ready(function() {
  //getAnimal
  var register = new Register();
  loader("register",register.registerData());

  $('#infoModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var gps = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  var animal = register.getAnimal(gps)

  modal.find('.modal-title').text(animal.name)
  modal.find('.modal-body #name').append(animal.name)
  modal.find('.modal-body #gps').append(animal.tracker)
  modal.find('.modal-body #bday').append(animal.bday)
  modal.find('.modal-body #type').append(animal.type)
  modal.find('.modal-body #sex').append(animal.sex)
  modal.find('.modal-body #milk').append(animal.lmilk)
  modal.find('.modal-body #children').append(animal.children)
});

//
$('#infoModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)

  modal.find('.modal-title').text("")
  modal.find('.modal-body #name').html("")
  modal.find('.modal-body #gps').html("")
  modal.find('.modal-body #bday').html("")
  modal.find('.modal-body #type').html("")
  modal.find('.modal-body #sex').html("")
  modal.find('.modal-body #milk').html("")
  modal.find('.modal-body #children').html("")
});

$('#modificaModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var gps = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  var animal = register.getAnimal(gps)

  modal.find('.modal-body #gps').val(animal.tracker)
  modal.find('.modal-title').text(animal.name)
  modal.find('.modal-body #milkLitres').val(animal.lmilk);
  modal.find('.modal-body #numberChildren').val(animal.children)
});

//
$('#modificaModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)

  modal.find('.modal-title').html("")
  modal.find('.modal-body #gps').html("")
  modal.find('.modal-body #milkLitres').html("")
  modal.find('.modal-body #children').html("")
});

$('#modifyButton').click(function (event){
  var modal = $(this)
  var gps = $('input[name = "gps"]').val()

  var animal = register.getAnimal(gps) 
  var milkLitres = $('input[name = "litres"]').val()
  var children = $('input[name = "children"]').val()
  
  register.update(gps, milkLitres,children)

});

$('#eliminaModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var gps = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  var animal = register.getAnimal(gps)

  modal.find('.modal-title').text("Attenzione!");
  modal.find('.modal-body #gpsToDelete').val(animal.tracker)
  modal.find('.modal-body #animalName').text(animal.name);
});

$('#eliminaModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)

  modal.find('.modal-title').html("")
  modal.find('.modal-body #gpsToDelete').html("")
  modal.find('.modal-body #animalName').html("")
});

$('#eliminaButton').click(function (event){
  var modal = $(this)
  var gps = $('input[name = "gpsToDelete"]').val()
  console.log("Ciaoooo"+gps)

  //register.deleteAnimal(gps)

  //$(' .register').load(' .register');
  //loader("register",register.registerData());
  //$(".register").load(' .register');

  register.deleteAnimal(gps);
  
 // $(".register").load(' .register');
  //dropTable("register", register.registerData());
 // loader("register",register.registerData());


        
          
  //loader("register",register.registerData());



});


$('#ricerca').submit(function(e){
        //fare un filter su elementi che possiedono nell'html una substring del nome dell'animale
        let list = register.registerData()
        let page = []
        $('#register tbody tr').remove()
      
        list.forEach(e =>{
            let str = e.name
            let srch = $('input[name = "srch"]').val()
           
            if(str.match(srch) || str.toLowerCase().match(srch) || str.toLowerCase().includes(srch.toLowerCase())){
                page.push(e)
            }
        });

        loader("register", page)
        return false
        //dobbiamo ricorda che possiamo avere solo 10 elementi per pagin
    });
 });
</script>
</body>
</html>