<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/stile.css" type = "text/css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="js/animal.js"></script>
    <script src = "js/loadTable.js"></script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <title>Registro dati</title>
	<script>
		$(function(){
			$("#navbar").load("header.html");
		});
  </script>
</head>
<body>
<div id= navbar></div>
<div class="contorno" style="background-image: url('img/bg_1.jpg'); z-index: -1;">
  <div class="container">
    <div class="row no-gutters slider-text align-items-center justify-content-center">
      <div class="col-md-9 ftco-animate text-center">
        <h1 class="mb-0 bread">Registro dati</h1>
      </div>
    </div>
  </div>
</div>

<hr>


<div class="container">
    <!-- Search form -->
    <form class="form-inline d-flex justify-content-left md-form form-sm mt-0" id="ricerca">
        <i class="fas fa-search" aria-hidden="true"></i>
        <input class="form-control form-control-sm ml-3 " type="text" placeholder="Inserisci nome animale"
        aria-label="Search" name="srch" style="width: 70%; margin-right: 8px;">
        <button id="cerca" type="submit" class="form-control form-control" > Cerca</button>
        <span><button id="aggiungiAnimale" type="submit" class="form-control form-control" > Aggiungi Nuovo Animale</button></span>
    </form><br>
    
    <table id="register" class="table table-striped">
      <thead>
        <tr>
          <th name="gps">Codice Gps</th>
          <th name="name">Nome</th>
          <th name="type">Tipo</th>
		   <th name="info">Info</th>
		  <th name="modify">Modifica</th>
          <th name="delete">Elimina</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div class="container">
    <ul class="pagination justify-content-center">
      <li class="page-item disabled"><a class="page-link" href="#">Pagina</a></li>
      
    </ul>
  </div>

<!--Modal per icona info -->
<div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="infoModalLabel">New message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <label><strong>Codice GPS:</strong>  </label>
        <label id = "gps"></label><br>
        <label><strong>Nascita:</strong>  </label>
        <label id="bday"></label><br>
        <label><strong>Tipo:</strong> </label>
        <label id = "type"></label><br>
        <label><strong>Sesso:</strong> </label>
        <label id = "sex"></label><br>
        <label><strong>Litri di latte prodotto:</strong> </label>
        <label id = "milk"></label><br>
        <label><strong>Numero di parti:</strong> </label>
        <label id= "children"></label><br>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Chiudi</button>
        </div>
      </div>
    </div>
  </div>

  <!--Modal per icona modifica -->
<div class="modal fade" id="modificaModal" tabindex="-1" role="dialog" aria-labelledby="modificaModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="modificaModalLabel">New message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <label hidden ><strong> GPS:</strong> </label>
        <input hidden id="gps" name="gps"></label><br>
        <label><strong>Litri di latte prodotto:</strong> </label>
        <label id = "milk"></label>
        <span><input name="litres" type="number" id="milkLitres" value="-1" min="0" max="100" step="1"/></span><br>
        <label><strong>Numero di parti:</strong> </label>
        <label id= "children"></label>
        <span><input type="number" id="numberChildren" name="children" value="-1" min="0" max="100" step="1"/></span>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" id="modifyButton" class="btn btn-secondary" data-dismiss="modal">Salva</button>
        </div>
      </div>
    </div>
  </div>

  <!--Modal per icona elimina -->
<div class="modal fade" id="eliminaModal" tabindex="-1" role="dialog" aria-labelledby="eliminaModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="eliminaModalLabel">New message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <label hidden ><strong> GPS:</strong> </label>
        <input hidden id="gpsToDelete" name="gpsToDelete"></label><br>
        <label>Sei sicuro di voler eliminare</label>
        <strong id="animalName"></strong>
        <label>dal registro?</label>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" id="eliminaButton" class="btn btn-primary" data-dismiss="modal">Si</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" >No</button>
        </div>
      </div>
    </div>
  </div>

  <!--Modal per messaggio di avvenuta eliminazione -->
<div class="modal fade" id="messaggioModal" tabindex="-1" role="dialog" aria-labelledby="messaggioModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="messaggioModalLabel">Perfetto!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <strong id="animalName"></strong>
          <label>e' stato eliminato correttamente dal registro!</label>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal" >Okay</button>
        </div>
      </div>
    </div>
  </div>

<!--Modal per aggiunta animale -->
<div class="modal fade" id="aggiungiAnimaleModal" tabindex="-1" role="dialog" aria-labelledby="aggiungiAnimaleModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="aggiungiAnimaleModalLabel">Aggiungi un nuovo animale</h5>
        <button type="button" class="close" id="stopAddAnimal" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <h6 id="firstForm">Dati iniziali</h6>
        <i class="fas fa-chevron-right" id="breadcrumbs"></i>
        <h6 id="secondForm" style="color:#C0C0C0">Dati avanzati</h6><br><br>
        <label><strong> Codice GPS:</strong> </label>
        <input id="gpsToAdd" name="gpsToAdd" value="q016w" readonly><br><br>
        <label><strong>Nome</strong></label>
        <input id="nameToAdd" name="nameToAdd" placeholder="Fiocco" maxlength="10"><br><br>
        <label><strong>Data di nascita</strong></label>
        <input id="bdayToAdd" type="date"><br><br>
        <label><strong>Tipo</strong></label>
        <select name="typeToAdd" id="typeToAdd">
          <option value="Caprino">Caprino</option>
          <option value="Bovino">Bovino</option>
          <option value="Ovino">Ovino</option>
        </select>
  </div>
      
        <!--footer-->
        <div class="modal-footer">
          <button type="button" id="goToSecondForm" class="btn btn-primary">Avanti</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!--2Â° Modal per aggiunta animale -->
<div class="modal fade" id="aggiungiAnimale2Modal" tabindex="-1" role="dialog" aria-labelledby="aggiungiAnimale2ModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="aggiungiAnimale2ModalLabel">Aggiungi un nuovo animale</h5>
        <button type="button" id="stopAddAnimal2" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
        <h6 id="firstForm" style="color:#C0C0C0">Dati iniziali</h6>
        <i class="fas fa-chevron-right" id="breadcrumbs"></i>
        <h6 id="secondForm">Dati avanzati</h6><br><br>
        <label><strong> Sesso:</strong> </label>
         <span>
            <div class="col-5" >
              <div class="form-check form-check-group" id="sexForm">
                <input name="gruppo4" type="radio" id="male" value="male" checked>
                <label for="radio10">Maschio</label>
              </div>
              <div class="form-check form-check-group" id="sexForm">
                <input name="gruppo4" type="radio" id="female" value="female">
                <label for="radio11">Femmina</label>
              </div>
            </div>
         </span>
        <label><strong>Litri di latte</strong></label>
        <input type="number" id="milkLitresToAdd" name="milkLitresToAdd" value=0 disabled><br><br>
        <label><strong>Numero di parti</strong></label>
        <input type="number" id="childrenToAdd" name="childrenToAdd" value=0 disabled><br><br>
      </div>
      
        <!--footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="goToFirstForm" data-dismiss="modal" >Modifica dati iniziali</button>
          <button type="button" id="saveAnimal" class="btn btn-primary" data-dismiss="modal">Salva</button>
        </div>
      </div>
    </div>
  </div>

   <!--Modal per messaggio di avvenuta aggiunta -->
<div class="modal fade" id="messaggioAggiuntaModal" tabindex="-1" role="dialog" aria-labelledby="messaggioAggiuntaModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="messaggioAggiuntaModalLabel">Perfetto!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
         <label>L'animale e' stato aggiunto al sistema!</label>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal" >Okay</button>
          <button type="button" id="addAnotherAnimal" class="btn btn-primary" data-dismiss="modal">Aggiungi un altro animale</button>
        </div>
      </div>
    </div>
  </div>

     <!--Modal per esortare a riempire tutti i campi -->
<div class="modal fade" id="messaggioRiempiModal" tabindex="-1" role="dialog" aria-labelledby="messaggioRiempiModalLabel" aria-hidden="true" style="margin-top: 250px;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!--Header-->
      <div class="modal-header">
        <h5 class="modal-title" id="messaggioRiempiModalLabel">Attenzione!</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!--body-->
      <div class="modal-body">
         <label>Devi riempire tutti i campi per poter andare avanti!</label>
      </div>
        <!--footer-->
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal" >Okay</button>
        </div>
      </div>
    </div>
  </div>

<script>
$('document').ready(function() {
  //getAnimal
  var register = new Register();
  loader("register",register.registerData());

  $('#infoModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var gps = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  var animal = register.getAnimal(gps)

  modal.find('.modal-title').text(animal.name)
  modal.find('.modal-body #name').append(animal.name)
  modal.find('.modal-body #gps').append(animal.tracker)
  modal.find('.modal-body #bday').append(animal.bday)
  modal.find('.modal-body #type').append(animal.type)
  modal.find('.modal-body #sex').append(animal.sex)
  modal.find('.modal-body #milk').append(animal.lmilk)
  modal.find('.modal-body #children').append(animal.children)
});

//
$('#infoModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)

  modal.find('.modal-title').text("")
  modal.find('.modal-body #name').html("")
  modal.find('.modal-body #gps').html("")
  modal.find('.modal-body #bday').html("")
  modal.find('.modal-body #type').html("")
  modal.find('.modal-body #sex').html("")
  modal.find('.modal-body #milk').html("")
  modal.find('.modal-body #children').html("")
});

$('#modificaModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var gps = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  var animal = register.getAnimal(gps)

  modal.find('.modal-body #gps').val(animal.tracker)
  modal.find('.modal-title').text(animal.name)
  modal.find('.modal-body #milkLitres').val(animal.lmilk);
  modal.find('.modal-body #numberChildren').val(animal.children)
});

//
$('#modificaModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)

  modal.find('.modal-title').html("")
  modal.find('.modal-body #gps').html("")
  modal.find('.modal-body #milkLitres').html("")
  modal.find('.modal-body #children').html("")
});

$('#modifyButton').click(function (event){
  var modal = $(this)
  var gps = $('input[name = "gps"]').val()

  var animal = register.getAnimal(gps) 
  var milkLitres = $('input[name = "litres"]').val()
  var children = $('input[name = "children"]').val()
  
  register.update(gps, milkLitres,children)

});

$('#eliminaModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var gps = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  var animal = register.getAnimal(gps)

  modal.find('.modal-title').text("Attenzione!");
  modal.find('.modal-body #gpsToDelete').val(animal.tracker)
  modal.find('.modal-body #animalName').text(animal.name);
});

$('#eliminaModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)

  modal.find('.modal-title').html("")
  modal.find('.modal-body #gpsToDelete').html("")
  modal.find('.modal-body #animalName').html("")
});

$('#eliminaButton').click(function (event){
  var modal = $(this)
  var gps = $('input[name = "gpsToDelete"]').val()

  register.deleteAnimal(gps);
  $('#eliminaButton').val(register.getAnimal(gps).name)
  $('#messaggioModal').modal('show')
});

$('#messaggioModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var gps = $(this).val // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  var animalName = $('#eliminaButton').val()

  modal.find('.modal-body #animalName').text(animalName)
});

$('#aggiungiAnimale').click(function(event) {
  $('#aggiungiAnimaleModal').modal('show')

});

$('#goToFirstForm').click(function(event) {
  $('#aggiungiAnimaleModal').modal('show')   

});

$('#goToSecondForm').click(function(event) {
  if($('input[name = "nameToAdd"]').val() == "" ||  document.getElementById("bdayToAdd").value=="")
    $('#messaggioRiempiModal').modal('show')     

  else
  { 
    $('#aggiungiAnimaleModal').modal('hide')
    $('#aggiungiAnimale2Modal').modal('show')
  }

});

$('input[type=radio][name=gruppo4]').change(function() {
    if (this.value == 'male') {
      document.getElementById("childrenToAdd").setAttribute('disabled', 'disabled');
      document.getElementById("milkLitresToAdd").setAttribute('disabled', 'disabled');
    }
    else if (this.value == 'female') {
      document.getElementById("childrenToAdd").removeAttribute('disabled')
      document.getElementById("milkLitresToAdd").removeAttribute('disabled')
    }
});

$('#saveAnimal').click(function(event) {
  $('#messaggioAggiuntaModal').modal('show')

  var name = $('input[name = "nameToAdd"]').val()
  var birth = document.getElementById("bdayToAdd").value;
  var type = document.getElementById("typeToAdd").value;
  //var sex= $('#sexForm option:selected').text();
  var checkBox = document.getElementById("male");
  if (checkBox.checked == true)
    sex="Maschio"
  
  else
    sex="Femmina"
  var milkLitres = $('input[name = "milkLitresToAdd"]').val()
  var children = $('input[name = "childrenToAdd"]').val()

  
  var year=String(birth).substr(0,4)
  var month=String(birth).substr(5,2)
  var day=String(birth).substr(8)

  var bday=new Date(parseInt(year),parseInt(month), parseInt(day)).toDateString()

  //console.log("Dati:"+name+birth+type+sex+milkLitres+children)
  var animal = new Animal ("q016w",name, type, bday, sex, milkLitres, children, 70,[70,71,71,81,69,70], {lat: 40.690140, lng: 14.714848},"Via Rotonda 4","Sta male")
  register.addAnimal(animal)

  $('#nameToAdd').val('');
  $('#bdayToAdd').val('');
  $('#typeToAdd').val('Caprino');
  $('#milkLitresToAdd').val('');
  $('#childrenToAdd').val('');
});

$('#stopAddAnimal').click(function(event) {
  $('#nameToAdd').val('');
  $('#bdayToAdd').val('');
  $('#typeToAdd').val('');
  $('#milkLitresToAdd').val('0');
  $('#childrenToAdd').val('0');
  $('#typeToAdd').val('Caprino');
  $('#male').prop('checked', true);


});

$('#stopAddAnimal2').click(function(event) {
  $('#nameToAdd').val('');
  $('#bdayToAdd').val('');
  $('#typeToAdd').val('');
  $('#milkLitresToAdd').val('0');
  $('#childrenToAdd').val('0');
  $('#typeToAdd').val('Caprino');
  $('#male').prop('checked', true);

});

$('#addAnotherAnimal').click(function(event) {
  $('#aggiungiAnimaleModal').modal('show')

});


$('#ricerca').submit(function(e){
        //fare un filter su elementi che possiedono nell'html una substring del nome dell'animale
        let list = register.registerData()
        let page = []
        $('#register tbody tr').remove()
      
        list.forEach(e =>{
            let str = e.name
            let srch = $('input[name = "srch"]').val()
           
            if(str.match(srch) || str.toLowerCase().match(srch) || str.toLowerCase().includes(srch.toLowerCase())){
                page.push(e)
            }
        });

        loader("register", page)
        return false
        //dobbiamo ricorda che possiamo avere solo 10 elementi per pagin
    });
 });
</script>
</body>
</html>